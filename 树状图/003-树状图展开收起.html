<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>d3.js-树状图展开/收起</title>
  <link rel="stylesheet" type="text/css" href="./css/index.css"/>
</head>
<body>
    <a href="https://blog.csdn.net/selina_chan/article/details/51260516" target="_blank" style="display: block;">示例</a>
    <a href="https://github.com/xswei/d3js_doc/blob/master/API_Reference/API.md" target="_blank" style="display: block;">文档V5</a>

    <script type="text/javascript" src="./js/d3.v5.min.js"></script>
    <script src="./js/dataConfig.js"></script>
    <script src="./js/d3Config.js"></script>
    <script>
      let rectW = 100,  // 矩形宽
          rectH = 50,   // 矩形高
          rectBW = 200,  // “红楼梦任务关系图”矩形宽
          rectBH = 100,  // “红楼梦任务关系图”矩形高
          initScale = 0.5,  // 设置初始缩放比例
          translateX = getSVGSize().width * 0.2;  // 设置g.container的x位置

      let svg = d3.select('body').append('svg'),
          hierarchyData = null,  // 层级布局
          tree = null,   // 树形图
          treeData = null,
          nodesData = null,
          linksData = null,
          linkHorizontal = null,  // 创建贝塞尔曲线生成器
          texts = null,
          nodes = null,
          links = null,
          g = svg.append('g').attr('class', 'container'),
          linksG = g.append('g').attr('class', 'links-group'),  // linksG、nodesG、textsG三个有顺序要求，线>节点>文字（文字被覆盖是绘制的顺序问题）
          nodesG = g.append('g').attr('class', 'nodes-group'),
          textsG = g.append('g').attr('class', 'texts-group');
          
      initTree(); 
      
      // 官网未提供树形图的restart方法，因此只能手动去修改位置
      window.onresize = () => {
        setSvgSize(svg);
        
        // 设置初始缩放比列
        translateX = getSVGSize().width * 0.2;  // 设置g.container的x位置
        g.attr("transform", `translate(${translateX}, ${getSVGSize().height / 2}) scale(${initScale})`);
      }
    </script>
</body>
</html>